# Yandex Market Sync Service v2.0

Интеграция с Яндекс Маркетом теперь полностью настроена и работает через "бизнес-аккаунт" (Business ID), что позволило получить доступ к чатам.

## Что было сделано
*   **Синхронизация заказов**: Подгружаются активные заказы.
*   **Синхронизация чатов**: Загружается список всех активных чатов.
*   **История сообщений**: Скрипт скачивает всю историю переписки для каждого чата.
*   **Отправка ответов**: Вы можете отвечать клиентам прямо из приложения Staff Mobile.

## Важно: Настройка базы (Supabase)

Чтобы чаты появились в приложении, убедитесь, что вы:
1.  **Выполнили SQL-код** из файла `/supabase/migrations/20260206_platform_chats.sql`.
2.  **Включили Realtime** для новых таблиц. В консоли Supabase:
    *   Перейдите в **Database** -> **Replication**.
    *   В блоке **supabase_realtime** нажмите "Edit tables".
    *   Добавьте таблицы `platform_chats` и `platform_messages`.
    *   *(Это нужно, чтобы новые сообщения появлялись в приложении мгновенно без перезагрузки).*

## Как запустить сервис

### Локально
```bash
npm run sync
```

### На хостинге (Production)
Для того чтобы скрипт работал автоматически и перезапускался при сбоях или перезагрузке сервера, рекомендуется использовать **PM2**:

1. **Установите PM2** на сервере:
   ```bash
   npm install -g pm2
   ```

2. **Запустите через конфиг**:
   ```bash
   pm2 start ecosystem.config.cjs
   ```

3. **Настройте автозапуск** при рестарте ОС:
   ```bash
   pm2 save
   pm2 startup
   ```

Это гарантирует, что даже если сервер упадет или перезагрузится, синхронизация с Яндексом поднимется автоматически.

## Мониторинг логов
Если что-то не работает, проверьте логи:
```bash
pm2 logs bazzar-yandex-sync
```
Или файлы в папке `logs/`.
